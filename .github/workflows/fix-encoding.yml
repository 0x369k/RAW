name: Fix Encoding Issues (ISO-8859-1 ‚Üí UTF-8)

on:
  push:
    paths:
      - "docs/**"  # √úberpr√ºft alle Dateien im "docs"-Ordner
  workflow_dispatch: # Manuelles Starten der Action m√∂glich

jobs:
  fix_encoding:
    runs-on: ubuntu-latest
    steps:
      - name: Repository klonen
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # Verhindert Probleme mit "detached HEAD"

      - name: Erstelle Log-Datei
        run: echo "Encoding Fix Log - $(date)" > encoding-fix.log

      - name: √úberpr√ºfe und fixe Encoding-Fehler (ISO-8859-1 ‚Üí UTF-8)
        run: |
          for file in $(find docs -type f); do
            echo "üîç Pr√ºfe Datei: $file" | tee -a encoding-fix.log
            
            # Pr√ºfe, ob Datei NICHT in UTF-8 ist
            if file -i "$file" | grep -q "charset=iso-8859-1"; then
              echo "‚ö† Datei ist in ISO-8859-1: $file ‚Üí Konvertiere nach UTF-8" | tee -a encoding-fix.log
              mv "$file" "$file.bak"
              iconv -f ISO-8859-1 -t UTF-8 "$file.bak" -o "$file" || { echo "‚ùå Konvertierung fehlgeschlagen: $file" | tee -a encoding-fix.log; mv "$file.bak" "$file"; continue; }
              rm "$file.bak"
              echo "‚úÖ Datei erfolgreich konvertiert: $file" | tee -a encoding-fix.log
              git add "$file"
            else
              echo "‚úÖ Datei ist bereits UTF-8: $file" | tee -a encoding-fix.log
            fi
          done

      - name: √Ñnderungen committen (falls n√∂tig)
        run: |
          if git diff --staged --quiet; then
            echo "üöÄ Keine √Ñnderungen gefunden, kein Commit n√∂tig." | tee -a encoding-fix.log
            exit 0
          else
            git config --global user.name "github-actions"
            git config --global user.email "github-actions@github.com"
            git commit -m "üî• Automatische Konvertierung von ISO-8859-1 nach UTF-8"
          fi

      - name: √Ñnderungen pushen
        run: |
          git branch --show-current
          git pull --rebase origin main  # Verhindert Merge-Konflikte
          git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git HEAD:main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Log-Datei als Artefakt speichern
        uses: actions/upload-artifact@v4
        with:
          name: encoding-fix-log
          path: encoding-fix.log

